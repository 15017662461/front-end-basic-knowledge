<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>五环</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        body {
            height: 1000px;
        }

        .mental {
            position: fixed;
            top: 50%;
            left: 50%;
            margin-left: -180px;
            margin-top: -100px;
        }

        .first {
            position: absolute;
            z-index: 0;
            width: 100px;
            height: 100px;
            border: 10px solid blue;
            border-radius: 50%;

        }

        .second {
            position: absolute;
            left: 135px;
            z-index: 0;
            width: 100px;
            height: 100px;
            border: 10px solid black;
            border-radius: 50%;
        }

        .third {
            position: absolute;
            left: 270px;
            z-index: 0;
            width: 100px;
            height: 100px;
            border: 10px solid red;
            border-radius: 50%;
        }

        .forth {
            position: absolute;
            left: 70px;
            top: 50px;
            z-index: 1;
            width: 100px;
            height: 100px;
            border: 10px solid yellow;
            border-radius: 50%;
        }

        .fifth {
            position: absolute;
            left: 205px;
            top: 50px;
            z-index: 1;
            width: 100px;
            height: 100px;
            border: 10px solid green;
            border-radius: 50%;
        }
    </style>
</head>

<body>
    <div class="mental" id="main">
        <div class="first huan"></div>
        <div class="second huan"></div>
        <div class="third huan"></div>
        <div class="forth huan"></div>
        <div class="fifth huan"></div>
    </div>

    <script>

        const PENDING = 'pending'
        const FULFILLED = 'fulfilled'
        const REJECTED = 'rejected'

        class MyPromise{
            constructor(executor){
                try{
                    executor(this.resolve,this.reject)
                }catch(e){
                    this.reject(e)
                }
            }
            status = PENDING
            value = null
            reason = null
            resolveArr = []
            rejectArr = []

            resolve = (value) => {
                if(this.status === PENDING){
                    this.value = value
                    this.status = FULFILLED
                    while(this.resolveArr.length){
                        this.resolveArr.shift()(value)
                    }
                }
            }

            reject = (reason) => {
                if(this.status === PENDING){
                    this.reason = reason
                    this.status = REJECTED
                    while(this.rejectArr.length){
                        this.rejectArr.shift()(reason)
                    }
                }
            }

            then(onFulfilled,onRejected){
                const promise2 = new MyPromise((resolve,reject) => {
                    const microResolve = () => {
                        queueMicrotask(() => {
                            try{
                                let x = onFulfilled(this.value)
                                resolvePromise(x,resolve,reject)
                            }catch(e){
                                reject(e)
                            }
                        })
                    }

                    const microReject = () => {
                        queueMicrotask(() => {
                            try{
                                let x = onRejected(this.reason)
                                resolvePromise(x,resolve,reject)
                            }catch(e){
                                reject(e)
                            }
                        })
                    }

                    if(this.status === FULFILLED){
                        this.resolveArr.push(microResolve)
                        this.rejectArr.push(microReject)
                    }else if(this.status === FULFILLED){
                        microResolve()
                    }else if(this.status === REJECTED){
                        microReject()
                    }
                })
                return promise2
            }
        }

        function resolvePromise(x,resolve,reject){
            if(x instanceof MyPromise){
                x.then(resolve,reject)
            }else{
                resolve(x)
            }
        }
    </script>
</body>

</html>